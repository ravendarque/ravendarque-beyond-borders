import{r as l,R as C,j as e,B as D,C as ee,F as Re,a as te,S as we,b as Ce,I as ge,c as fe,M as z,A as qe,T as He,d as g,e as b,f as Je,g as Xe,h as Ve,i as Ye,k as Qe,l as ie,m as le,n as Ze,u as Pe,P as he,o as et,p as I,D as tt,q as rt,s as at,t as Ee,v as Fe,w as Se,z as H,x as st,y as nt,E as ot,G as it,H as lt,J as ct,K as dt,L as ut,N as pt,O as gt,Q as ce,U as ft,V as ht,W as mt,X as xt}from"./vendor-_IioyECX.js";import{f as ae}from"./flags-Bx44pUm1.js";import{r as bt}from"./renderer-DSFzcTLy.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();function yt(){const r=l.useRef(new Map);return l.useEffect(()=>{const t=r.current;return()=>{t.forEach(a=>{try{a.close()}catch{}}),t.clear()}},[]),r.current}class G extends Error{code;userMessage;recoverySuggestion;canRetry;originalError;constructor(t){super(t.message),this.name="AppError",this.code=t.code,this.userMessage=t.userMessage,this.recoverySuggestion=t.recoverySuggestion,this.canRetry=t.canRetry,this.originalError=t.originalError,Error.captureStackTrace&&Error.captureStackTrace(this,G)}toJSON(){return{name:this.name,code:this.code,message:this.message,userMessage:this.userMessage,recoverySuggestion:this.recoverySuggestion,canRetry:this.canRetry,stack:this.stack,originalError:this.originalError?.message}}}class vt extends G{constructor(t,a){super({code:"NETWORK_FAILURE",message:t,userMessage:"Unable to connect to the server. Please check your internet connection.",recoverySuggestion:"Check your internet connection and try again.",canRetry:!0,originalError:a}),this.name="NetworkError"}}class U extends G{constructor(t,a,s,n){super({code:t,message:a,userMessage:s,recoverySuggestion:n,canRetry:!1}),this.name="FileValidationError"}static fileTooLarge(t,a){const s=(t/1048576).toFixed(1),n=(a/(1024*1024)).toFixed(0);return new U("FILE_TOO_LARGE",`File size ${s}MB exceeds maximum ${n}MB`,`This file is too large (${s}MB). Maximum file size is ${n}MB.`,"Please choose a smaller image or compress it before uploading.")}static invalidFileType(t){return new U("FILE_INVALID_TYPE",`Invalid file type: ${t}`,"This file type is not supported. Please use JPG or PNG images.","Choose a JPG or PNG image file and try again.")}static loadFailed(t){return new U("FILE_LOAD_FAILED","Failed to load image file","Unable to load this image. The file may be corrupted.","Try a different image file or re-save this image and try again.")}static dimensionsTooLarge(t,a,s){return new U("FILE_INVALID_TYPE",`Image dimensions ${t}x${a} exceed maximum ${s}px`,`This image is too large (${t}x${a} pixels). Maximum dimension is ${s}px.`,`Please resize the image to ${s}px or smaller and try again.`)}}class Y extends G{constructor(t,a,s,n=!0,o){super({code:"RENDER_FAILED",message:t,userMessage:a,recoverySuggestion:s,canRetry:n,originalError:o}),this.name="RenderError"}static canvasNotSupported(){return new Y("Canvas API not supported","Your browser does not support the features needed for this app.","Please try using a modern browser like Chrome, Firefox, or Safari.",!1)}static browserLimitExceeded(){return new Y("Browser rendering limit exceeded","This image is too large for your browser to process.","Try using a smaller image (under 4000x4000 pixels).",!1)}static renderFailed(t){return new Y("Rendering failed","Unable to create the bordered image. This might be a temporary issue.","Try adjusting the border settings or using a different image.",!0,t)}}class Q extends G{constructor(t,a,s,n,o=!1){super({code:t,message:a,userMessage:s,recoverySuggestion:n,canRetry:o}),this.name="FlagDataError"}static loadFailed(t){return new Q("FLAG_LOAD_FAILED","Failed to load flag definitions","Unable to load the flag library. This might be a network issue.","Check your internet connection and refresh the page.",!0)}static patternMissing(t){return new Q("FLAG_PATTERN_MISSING",`Flag ${t} has no pattern definition`,"This flag cannot be displayed because its design data is missing.","Please choose a different flag or report this issue.",!1)}static dataInvalid(t){return new Q("FLAG_DATA_INVALID",`Flag ${t} has invalid data`,"This flag has invalid design data and cannot be used.","Please choose a different flag or report this issue.",!1)}}function Z(r){if(r instanceof G)return r;if(r instanceof Error){const t=r.message.toLowerCase();return t.includes("network")||t.includes("fetch")?new vt(r.message,r):t.includes("canvas")?Y.canvasNotSupported():new G({code:"UNKNOWN_ERROR",message:r.message,userMessage:"An unexpected error occurred.",recoverySuggestion:"Please try again. If the problem persists, refresh the page.",canRetry:!0,originalError:r})}return new G({code:"UNKNOWN_ERROR",message:String(r),userMessage:"An unexpected error occurred.",recoverySuggestion:"Please try again. If the problem persists, refresh the page.",canRetry:!0})}function jt(){const r="/ravendarque-beyond-borders/beta/0.2.25-pr/",t="production";return{getAssetUrl(a){const s=a.startsWith("/")?a.slice(1):a;return`${r.endsWith("/")?r:`${r}/`}${s}`},getBaseUrl(){return r},isDevelopment(){return t==="development"},isProduction(){return t==="production"}}}const Te=jt();function me(r){return Te.getAssetUrl(r)}function wt(r,t){const[a,s]=l.useState(null),[n,o]=l.useState(!1),c=l.useRef(null);c.current=a;const u=l.useCallback(async(h,d,i)=>{const{size:x,thickness:p,insetPct:f,flagOffsetX:m,presentation:y,bg:S}=i;if(!h){o(!1);return}if(!d){c.current&&(URL.revokeObjectURL(c.current),s(null)),o(!1);return}try{o(!0);const w=r.find(F=>F.id===d);if(!w)throw Q.patternMissing(d);const N=await(await fetch(h)).blob(),W=await createImageBitmap(N),A={...w};w.layouts?.[0]?.colors&&!w.pattern&&(A.pattern={type:"stripes",stripes:w.layouts[0].colors.map(F=>({color:F,weight:1})),orientation:"horizontal"});let R;if(y==="cutout"&&w.png_full){const F=w.png_full;if(t.has(F))R=t.get(F);else{const X=await(await fetch(me(`flags/${w.png_full}`))).blob();R=await createImageBitmap(X),t.set(F,R)}}const B=await bt(W,A,{size:x,thicknessPct:p,imageInsetPx:Math.round(f*-1/100*x),flagOffsetPx:{x:Math.round(m),y:0},presentation:y,backgroundColor:S==="transparent"?null:S,borderImageBitmap:R}),_=URL.createObjectURL(B.blob);c.current&&URL.revokeObjectURL(c.current),s(_),o(!1);try{window.__BB_UPLOAD_DONE__=!0}catch{}}catch(w){throw o(!1),Z(w)}},[r,t]);return l.useEffect(()=>()=>{c.current&&URL.revokeObjectURL(c.current)},[]),{overlayUrl:a,isRendering:n,render:u}}function Ct(){const r=l.useRef(null),t=l.useRef(null),a=l.useCallback(c=>{r.current&&r.current.focus(c)},[]),s=l.useCallback(()=>{t.current=document.activeElement},[]),n=l.useCallback(()=>{t.current&&t.current.focus&&(t.current.focus(),t.current=null)},[]),o=l.useCallback(c=>{if(!c)return;const u=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");c.querySelector(u)?.focus()},[]);return{focusRef:r,setFocus:a,saveFocus:s,restoreFocus:n,focusFirstIn:o}}function St(r){l.useEffect(()=>{const t=a=>{r.forEach(s=>{if(s.enabled===!1)return;const n=a.key.toLowerCase()===s.key.toLowerCase(),o=s.ctrlKey?a.ctrlKey||a.metaKey:!0,c=s.shiftKey?a.shiftKey:!a.shiftKey,u=s.altKey?a.altKey:!a.altKey;n&&o&&c&&u&&s.callback(a)})};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r])}const kt=["transgender-pride","rainbow-pride","bisexual-pride","pansexual-pride","lesbian-pride","nonbinary-pride","asexual-pride"];function It(r,t,a){const s=l.useRef(new Set);l.useEffect(()=>{if(typeof window>"u"||!("requestIdleCallback"in window)||r.length===0)return;async function n(u){if(!u.png_full)return;const h=u.png_full;if(!t.has(h)&&!s.current.has(h))try{s.current.add(h);const d=await fetch(me(`flags/${u.png_full}`));if(!d.ok)return;const i=await d.blob(),x=await createImageBitmap(i);t.set(h,x),Te.isDevelopment()}catch{}}function o(){const u=kt.map(i=>r.find(x=>x.id===i)).filter(i=>i!==void 0).filter(i=>i.id!==a);let h=0;function d(i){for(;h<u.length&&(i.timeRemaining()>0||i.didTimeout);){const x=u[h];if(h++,n(x),i.timeRemaining()<10)break}h<u.length&&requestIdleCallback(d,{timeout:2e3})}requestIdleCallback(d,{timeout:2e3})}const c=setTimeout(o,1e3);return()=>{clearTimeout(c)}},[r,t,a])}function V(r,t){const[a,s]=l.useState(()=>{try{const n=localStorage.getItem(r);return n?JSON.parse(n):t}catch{return t}});return l.useEffect(()=>{try{a===t||a===""||a===null?localStorage.removeItem(r):localStorage.setItem(r,JSON.stringify(a))}catch{}},[r,a,t]),[a,s]}function Rt(r={}){const{initialImageUrl:t=null,initialFlagId:a=""}=r,[s,n]=l.useState(1),[o,c]=l.useState(t),[u,h]=l.useState(null),[d,i]=l.useState(a),[x,p]=V("workflow-thickness",7),[f,m]=V("workflow-insetPct",0),[y,S]=V("workflow-flagOffsetX",0),[w,M]=V("workflow-presentation","ring"),[N,W]=V("workflow-bg","transparent"),A=o!==null,R=o!==null&&d!=="",B=[];A&&B.push(1),R&&B.push(2),l.useEffect(()=>{const v=new URL(window.location.href);s>1?v.searchParams.set("step",s.toString()):v.searchParams.delete("step"),window.history.pushState({},"",v.toString())},[s]),l.useEffect(()=>{const P=new URL(window.location.href).searchParams.get("step");if(P){const k=parseInt(P,10);k===2&&o!==null?n(2):k===3&&(o!==null&&d!=="")&&n(3)}},[]),l.useEffect(()=>{const v=()=>{const k=new URL(window.location.href).searchParams.get("step");if(!k)n(1),$("Navigated to step 1 of 3: Choose Image");else{const E=parseInt(k,10);if(E>=1&&E<=3){const O=o!==null,se=o!==null&&d!=="";if(E===1)n(1),$("Navigated to step 1 of 3: Choose Image");else if(E===2&&O)n(2),$("Navigated to step 2 of 3: Choose Flag");else if(E===3&&se)n(3),$("Navigated to step 3 of 3: Preview & Customize");else{const T=new URL(window.location.href);s>1?T.searchParams.set("step",s.toString()):T.searchParams.delete("step"),window.history.replaceState({},"",T.toString())}}}};return window.addEventListener("popstate",v),()=>{window.removeEventListener("popstate",v)}},[o,d,s]);const _=l.useCallback(v=>{const P=o!==null,k=o!==null&&d!=="";if(v===2&&!P||v===3&&!k)return;n(v);const O=`Navigated to step ${v} of 3: ${["Choose Image","Choose Flag","Preview & Customize"][v-1]}`;$(O)},[o,d]),F=l.useCallback(()=>{const v=o!==null,P=o!==null&&d!=="";n(k=>k===1&&v?($("Navigated to step 2 of 3: Choose Flag"),2):k===2&&P?($("Navigated to step 3 of 3: Preview & Customize"),3):k)},[o,d]),re=l.useCallback(()=>{n(v=>{if(v>1){const P=v-1;return $(`Navigated to step ${P} of 3: ${["Choose Image","Choose Flag","Preview & Customize"][P-1]}`),P}return v})},[]),X=l.useCallback(()=>{n(1),c(null),h(null),i(""),p(7),m(0),S(0),M("ring"),W("transparent");const v=new URL(window.location.href);v.searchParams.delete("step"),window.history.replaceState({},"",v.toString()),localStorage.removeItem("workflow-thickness"),localStorage.removeItem("workflow-insetPct"),localStorage.removeItem("workflow-flagOffsetX"),localStorage.removeItem("workflow-presentation"),localStorage.removeItem("workflow-bg"),$("Workflow reset. Starting over from step 1.")},[i,p,m,S,M,W]);return{currentStep:s,imageUrl:o,imageName:u,flagId:d,thickness:x,insetPct:f,flagOffsetX:y,presentation:w,bg:N,completedSteps:B,canProceedToStep2:A,canProceedToStep3:R,goToStep:_,nextStep:F,prevStep:re,startOver:X,setImageUrl:c,setImageName:h,setFlagId:i,setThickness:p,setInsetPct:m,setFlagOffsetX:S,setPresentation:M,setBg:W}}function $(r){if(typeof document>"u")return;const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="visually-hidden",t.textContent=r,document.body.appendChild(t);const a=setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},1e3);return()=>{clearTimeout(a),document.body.contains(t)&&document.body.removeChild(t)}}const ke=10*1024*1024,Pt=["image/jpeg","image/jpg","image/png"],de=4096;async function Et(r){return new Promise((t,a)=>{const s=new Image,n=URL.createObjectURL(r);s.onload=()=>{URL.revokeObjectURL(n),s.width>de||s.height>de?a(U.dimensionsTooLarge(s.width,s.height,de)):t()},s.onerror=()=>{URL.revokeObjectURL(n),a(U.loadFailed())},s.src=n})}async function Ie(r){if(r.size>ke)throw U.fileTooLarge(r.size,ke);if(!Pt.includes(r.type))throw U.invalidFileType(r.type);await Et(r)}function Ft({onFileChange:r,onError:t}){const[a,s]=C.useState(!1),[n,o]=C.useState(!1),c=C.useRef(null),u=async p=>{const f=p.target.files?.[0];if(f)try{o(!0),await Ie(f),r(p)}catch(m){p.target.value="",t&&m instanceof U&&t(m)}finally{o(!1)}},h=p=>{p.preventDefault(),p.stopPropagation(),s(!0)},d=p=>{p.preventDefault(),p.stopPropagation()},i=p=>{p.preventDefault(),p.stopPropagation(),p.currentTarget===p.target&&s(!1)},x=async p=>{p.preventDefault(),p.stopPropagation(),s(!1);const f=p.dataTransfer.files?.[0];if(f)try{if(o(!0),await Ie(f),c.current){const m=new DataTransfer;m.items.add(f),c.current.files=m.files;const y=new Event("change",{bubbles:!0});c.current.dispatchEvent(y)}}catch(m){t&&m instanceof U&&t(m)}finally{o(!1)}};return e.jsx("div",{children:e.jsxs("div",{onDragEnter:h,onDragOver:d,onDragLeave:i,onDrop:x,style:{position:"relative",border:a?"2px dashed var(--accent)":"2px dashed transparent",borderRadius:"4px",padding:a?"8px":"10px",backgroundColor:a?"rgba(249, 115, 22, 0.08)":"transparent",transition:"all 150ms ease"},children:[e.jsx("input",{ref:c,accept:"image/jpeg,image/jpg,image/png",style:{display:"none"},id:"file-upload",type:"file",onChange:u,"aria-label":"Upload image file (JPG or PNG, max 10 MB)","aria-describedby":"file-upload-requirements"}),e.jsx("label",{htmlFor:"file-upload",style:{cursor:n?"wait":"pointer",display:"block"},children:e.jsx(D,{variant:"contained",component:"span",startIcon:n?e.jsx(ee,{size:20,sx:{color:"white"}}):e.jsx(Re,{}),fullWidth:!0,disabled:n,"aria-label":"Choose image file to upload or drag and drop","aria-busy":n,sx:{pointerEvents:"none"},children:n?"Validating...":a?"Drop image here":"Choose Image"})}),!a&&e.jsx("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"0.875rem",color:"var(--text-secondary)",opacity:.7},children:"or drag and drop"})]})})}const Tt=C.memo(Ft);function Lt({value:r,flags:t,onChange:a,isLoading:s=!1}){const n=t.find(c=>c.id===r),o=n?`${n.displayName} selected`:"No flag selected";return s?e.jsxs(te,{fullWidth:!0,children:[e.jsx(we,{variant:"rectangular",height:56,sx:{borderRadius:1},"aria-label":"Loading flags...",role:"status","aria-busy":"true"}),e.jsx(Ce,{children:e.jsx(we,{width:"60%"})})]}):e.jsxs(te,{fullWidth:!0,children:[e.jsx(ge,{id:"flag-select-label",children:"Select a flag"}),e.jsxs(fe,{value:r,onChange:c=>a(c.target.value),label:"Select a flag",labelId:"flag-select-label","aria-describedby":"flag-select-description flag-helper-text",children:[e.jsx(z,{value:"",children:e.jsx("em",{children:"None"})}),t.map(c=>e.jsx(z,{value:c.id,children:c.displayName},c.id))]}),e.jsxs("span",{id:"flag-select-description",className:"visually-hidden",children:[o,". Choose a flag to add as a border to your avatar."]}),!r&&e.jsx(Ce,{id:"flag-helper-text",children:"Select a flag to add a colorful border to your avatar"})]})}const Nt=C.memo(Lt),At=({flags:r,selectedFlagId:t,onChange:a,disabled:s=!1,required:n=!1,error:o})=>{const c=C.useCallback(d=>{if(!d)return"Other";switch(d){case"authoritarian":return"Authoritarian States";case"occupied":return"Occupied / Disputed Territories";case"stateless":return"Stateless Peoples";case"oppressed":return"Oppressed Groups";default:return"Other"}},[]),u=C.useMemo(()=>[...r].sort((d,i)=>{const x=c(d.category),p=c(i.category),f=x.localeCompare(p);if(f!==0)return f;const m=d.displayName.split(" — ")[0],y=i.displayName.split(" — ")[0];return m.localeCompare(y)}),[r,c]),h=u.find(d=>d.id===t)||null;return e.jsx(qe,{options:u,value:h,onChange:(d,i)=>{a(i?.id||null)},getOptionLabel:d=>d.displayName.split(" — ")[0],groupBy:d=>c(d.category),disabled:s,renderInput:d=>e.jsx(He,{...d,label:"Choose a flag",required:n,error:!!o,helperText:o,"aria-label":"Choose a flag for your border"}),isOptionEqualToValue:(d,i)=>d.id===i.id,noOptionsText:"No options",clearOnEscape:!0,disableClearable:!1})};function Ot(){const[r,t]=l.useState(!1);return l.useEffect(()=>{if(!window.matchMedia)return;const a=window.matchMedia("(prefers-reduced-motion: reduce)");t(a.matches);const s=n=>{t(n.matches)};return a.addEventListener("change",s),()=>a.removeEventListener("change",s)},[]),r}const Dt=({flag:r,size:t="large",animate:a=!0,onClick:s})=>{const[n,o]=l.useState(!0),[c,u]=l.useState(!1),h=Ot(),d=a&&!h,i=()=>{o(!1),u(!1)},x=()=>{o(!1),u(!0)},p=()=>{if(!r)return"";const w=t==="small"&&r.png_preview?r.png_preview:r.png_full;return w?me(`flags/${w}`):""},f=t==="small"?144:288,m=t==="small"?96:192;if(!r)return e.jsxs(g,{"aria-label":"Flag preview","data-size":t,sx:{width:f,height:m,borderRadius:1,border:3,borderColor:"grey.300",borderStyle:"dashed",bgcolor:"grey.50",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,mb:3},children:[e.jsxs(g,{component:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",sx:{width:48,height:48,color:"grey.400"},children:[e.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),e.jsx("line",{x1:"4",y1:"22",x2:"4",y2:"15"})]}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",px:2,fontWeight:"medium"},children:"Choose a flag"})]});const y=s?"button":"div",S=s?{onClick:s,type:"button","aria-label":`View ${r.displayName} flag details`}:{};return e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:0,mb:3},"data-size":t,"data-animate":d,children:[e.jsxs(g,{component:y,...S,"aria-label":"Flag preview","aria-busy":n,"data-clickable":!!s,sx:{position:"relative",width:f,height:m,cursor:s?"pointer":"default",transition:"transform 0.2s","&:hover":s?{transform:"scale(1.05)"}:{},mb:2},children:[n&&e.jsx(g,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1,bgcolor:"grey.100"},children:e.jsx(ee,{size:t==="small"?24:40})}),e.jsx(g,{component:"img",src:p(),alt:`${r.displayName} flag`,onLoad:i,onError:x,sx:{width:f,height:m,borderRadius:1,objectFit:"cover",opacity:n?0:1,transition:"opacity 0.3s",boxShadow:1}}),c&&e.jsx(g,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1,bgcolor:"grey.200"},children:e.jsx(b,{variant:"body2",color:"error",sx:{textAlign:"center",px:2},children:"Failed to load"})})]}),e.jsx(b,{variant:t==="small"?"body2":"body1",sx:{fontWeight:"medium",textAlign:"center",mb:.5},children:r.name}),r.reason&&e.jsx(b,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:"28rem",px:1},children:r.reason})]})},ue=({currentStep:r,canGoBack:t,canGoNext:a,onBack:s,onNext:n,onFinish:o,onStartOver:c,isLoading:u=!1,nextLabel:h="Next",backLabel:d="Back",finishLabel:i="Download"})=>{const x=r===3,p=u,y=!(s&&t||c)&&(x&&o||n);return e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",width:"100%"},role:"navigation","aria-label":"Step navigation",children:[e.jsxs(g,{sx:{display:"flex",gap:2,justifyContent:y?"center":"space-between",width:"100%"},children:[s&&e.jsx(D,{variant:"outlined",onClick:s,disabled:!t||p,"aria-disabled":!t||p,startIcon:u?void 0:e.jsx(Je,{}),sx:{flex:"1 1 0"},children:d}),x&&o?e.jsx(D,{variant:"contained",onClick:o,disabled:p,"aria-disabled":p,startIcon:u?e.jsx(ee,{size:20,color:"inherit"}):void 0,sx:{flex:"1 1 0"},children:u?"Processing...":i}):n&&e.jsx(D,{variant:"contained",onClick:n,disabled:!a||p,"aria-disabled":!a||p,endIcon:u?e.jsx(ee,{size:20,color:"inherit"}):e.jsx(Xe,{}),sx:{flex:"1 1 0"},children:u?"Loading...":h})]}),c&&e.jsx(D,{variant:"text",onClick:c,disabled:p,"aria-disabled":p,startIcon:u?void 0:e.jsx(Ve,{}),sx:{color:"text.secondary"},children:"Start Over"})]})};function Mt({value:r,onChange:t}){return e.jsxs(te,{component:"fieldset",role:"radiogroup","aria-labelledby":"presentation-label",children:[e.jsx(Ye,{component:"legend",id:"presentation-label",children:"Presentation Style"}),e.jsxs(Qe,{row:!0,value:r,onChange:a=>t(a.target.value),"aria-labelledby":"presentation-label","aria-describedby":"presentation-description",children:[e.jsx(ie,{value:"ring",control:e.jsx(le,{inputProps:{"aria-describedby":"ring-description"}}),label:"Ring"}),e.jsx(ie,{value:"segment",control:e.jsx(le,{inputProps:{"aria-describedby":"segment-description"}}),label:"Segment"}),e.jsx(ie,{value:"cutout",control:e.jsx(le,{inputProps:{"aria-describedby":"cutout-description"}}),label:"Cutout"})]}),e.jsx("span",{id:"presentation-description",className:"visually-hidden",children:"Choose how the flag border appears around your avatar. Ring shows a full circular border, Segment shows a partial arc, and Cutout fills the border area with the flag pattern."}),e.jsx("span",{id:"ring-description",className:"visually-hidden",children:"Full circular border around the entire avatar"}),e.jsx("span",{id:"segment-description",className:"visually-hidden",children:"Partial arc border on one side of the avatar"}),e.jsx("span",{id:"cutout-description",className:"visually-hidden",children:"Flag pattern fills the border area completely"})]})}const Le=C.memo(Mt);function Bt(r,t){const a=l.useRef(null),s=l.useRef(r);return l.useEffect(()=>{s.current=r},[r]),l.useEffect(()=>()=>{a.current!==null&&clearTimeout(a.current)},[]),l.useCallback((...n)=>{a.current!==null&&clearTimeout(a.current),a.current=setTimeout(()=>{s.current(...n),a.current=null},t)},[t])}function Ut({label:r,value:t,min:a,max:s,step:n,onChange:o,unit:c="",debounceMs:u=150}){const[h,d]=l.useState(t);C.useEffect(()=>{d(t)},[t]);const i=Bt(o,u),x=l.useCallback((m,y)=>{const S=y;d(S),i(S)},[i]),p=C.useMemo(()=>`${r.replace(/\s+/g,"-").toLowerCase()}-label`,[r]),f=C.useMemo(()=>`${r.replace(/\s+/g,"-").toLowerCase()}-description`,[r]);return e.jsxs(g,{role:"group","aria-labelledby":p,children:[e.jsxs(b,{gutterBottom:!0,id:p,children:[r,": ",h,c]}),e.jsx(Ze,{value:h,onChange:x,min:a,max:s,step:n,"aria-labelledby":p,"aria-valuetext":`${r} ${h}${c}`,"aria-valuenow":h,"aria-valuemin":a,"aria-valuemax":s,"aria-describedby":f,valueLabelDisplay:"auto"}),e.jsxs("span",{id:f,className:"visually-hidden",children:["Use left and right arrow keys to adjust ",r.toLowerCase(),". Current value is ",h,c,". Range is from ",a," to ",s,"."]})]})}const J=C.memo(Ut);function Wt({size:r,displaySize:t,canvasRef:a,overlayUrl:s,isRendering:n,hasImage:o=!1,hasFlag:c=!1}){const u=Pe();return e.jsx(he,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center"},role:"region","aria-labelledby":"preview-heading",children:e.jsxs(g,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("canvas",{ref:a,width:r,height:r,style:{width:t,height:t,border:"1px solid",borderColor:u.palette.divider,borderRadius:"50%",imageRendering:"auto"},"aria-label":s?"Avatar with flag border applied":"Empty avatar canvas, awaiting image upload",role:"img","aria-busy":n}),s&&e.jsx("img",{src:s,alt:"Generated avatar with flag border",style:{position:"absolute",top:0,left:0,width:t,height:t,borderRadius:"50%",pointerEvents:"none"}}),!c&&!n&&e.jsxs(g,{sx:{position:"absolute",top:0,left:0,width:t,height:t,borderRadius:"50%",backgroundColor:u.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:1.5},role:"status","aria-label":o?"No flag selected yet. Select a flag to see your avatar.":"No image uploaded yet. Upload an image to get started.",children:[e.jsx(et,{sx:{fontSize:64,color:u.palette.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.2)"},"aria-hidden":"true"}),e.jsx(b,{variant:"body2",sx:{color:u.palette.mode==="dark"?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.4)",fontWeight:500,textAlign:"center",px:2},children:o?"Select a flag":"Upload an image"}),e.jsx(b,{variant:"caption",sx:{color:u.palette.mode==="dark"?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.3)",textAlign:"center",px:2},children:o?"to see your avatar":"to get started"})]}),n&&e.jsxs(g,{sx:{position:"absolute",top:0,left:0,width:t,height:t,borderRadius:"50%",backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2},role:"status","aria-live":"polite","aria-busy":"true","aria-label":"Rendering avatar with flag border, please wait",children:[e.jsx(ee,{size:48,sx:{color:"white"},"aria-hidden":"true","aria-label":"Loading progress indicator"}),e.jsx(b,{variant:"body2",sx:{color:"white",fontWeight:600,fontSize:"0.95rem"},"aria-hidden":"true",children:"Rendering..."}),e.jsx("span",{className:"visually-hidden",children:"Rendering avatar with flag border. This may take a moment."})]})]})})}const $t=C.memo(Wt);function Gt({stepNumber:r,title:t,isComplete:a=!1}){return e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},role:"heading","aria-level":3,children:[e.jsx(g,{sx:{width:40,height:40,borderRadius:"50%",backgroundColor:"background.paper",border:"2px solid",borderColor:a?"success.main":"primary.main",color:a?"success.main":"primary.main",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:"1.125rem",flexShrink:0,"@media (prefers-reduced-motion: no-preference)":{transition:"all 0.3s ease-in-out"}},children:r}),e.jsx(b,{variant:"h6",sx:{fontWeight:600,fontSize:"1.125rem",color:"text.primary"},children:t})]})}const pe=C.memo(Gt);function zt({onFileChange:r,onFileError:t,hasImage:a=!1,flagId:s,flags:n,onFlagChange:o,flagsLoading:c=!1,presentation:u,onPresentationChange:h,thickness:d,onThicknessChange:i,insetPct:x,onInsetPctChange:p,flagOffsetX:f,onFlagOffsetXChange:m,bg:y,onBgChange:S,onDownload:w,downloadDisabled:M,isDownloading:N=!1,onCopy:W,copyDisabled:A,isCopying:R=!1}){const B=l.useCallback(_=>{S(_.target.value)},[S]);return e.jsx(he,{sx:{p:4},role:"form","aria-labelledby":"controls-heading",children:e.jsxs(I,{spacing:3,children:[e.jsxs(I,{spacing:2,children:[e.jsx(pe,{stepNumber:1,title:"Choose Profile Image",isComplete:a}),e.jsx(b,{variant:"caption",sx:{pl:7,opacity:.9,fontSize:"0.8125rem",mt:"-6px !important"},children:"JPG or PNG, max 10 MB, up to 4K resolution"}),e.jsx(I,{spacing:2,sx:{pl:7},children:e.jsx(Tt,{onFileChange:r,onError:t})})]}),e.jsxs(I,{spacing:2,sx:{opacity:a?1:.5,pointerEvents:a?"auto":"none",transition:"opacity 0.3s ease"},children:[e.jsx(pe,{stepNumber:2,title:"Select Flag",isComplete:!!s}),e.jsx(I,{spacing:2,sx:{pl:7},children:e.jsx(Nt,{value:s,flags:n,onChange:o,isLoading:c})})]}),e.jsxs(I,{spacing:2,sx:{opacity:a&&s?1:.5,pointerEvents:a&&s?"auto":"none",transition:"opacity 0.3s ease"},children:[e.jsx(pe,{stepNumber:3,title:"Customize Appearance",isComplete:a&&!!s}),e.jsxs(I,{spacing:2,sx:{pl:7},children:[e.jsx(Le,{value:u,onChange:h}),e.jsx(J,{label:"Border thickness",value:d,min:3,max:20,step:1,onChange:i,unit:"%"}),e.jsx(J,{label:"Profile Image Inset/Outset",value:x,min:-10,max:10,step:1,onChange:p,unit:"%"}),u==="cutout"&&e.jsx(J,{label:"Flag Horizontal Offset",value:f,min:-200,max:200,step:5,onChange:m,unit:"px"}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(ge,{id:"background-select-label",children:"Background"}),e.jsxs(fe,{value:y,onChange:B,label:"Background",labelId:"background-select-label","aria-describedby":"background-description",children:[e.jsx(z,{value:"transparent",children:"Transparent"}),e.jsx(z,{value:"#ffffff",children:"White"}),e.jsx(z,{value:"#000000",children:"Black"})]}),e.jsx("span",{id:"background-description",className:"visually-hidden",children:"Choose the background color for your avatar. Transparent is recommended for most uses."})]})]})]}),e.jsxs(I,{direction:"row",spacing:2,children:[e.jsx(D,{variant:"outlined",startIcon:e.jsx(tt,{"aria-hidden":"true"}),onClick:w,disabled:M||N||R,fullWidth:!0,"aria-label":M?"Download button. Please upload an image and select a flag first.":"Download generated avatar as PNG file","aria-busy":N,children:N?"Downloading...":"Download"}),W&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(rt,{"aria-hidden":"true"}),onClick:W,disabled:A||N||R,fullWidth:!0,"aria-label":A?"Copy button. Please upload an image and select a flag first.":"Copy generated avatar to clipboard","aria-busy":R,children:R?"Copying...":"Copy"})]}),e.jsx("span",{className:"visually-hidden","aria-live":"polite",children:M?"The download and copy buttons will be enabled after you upload an image and select a flag.":"Click download to save your avatar as a PNG file, or copy to copy it to your clipboard."})]})})}C.memo(zt);const _t=({currentStep:r,completedSteps:t,steps:a,onStepClick:s,compact:n=!1})=>{const o=i=>t.includes(i),c=i=>r===i,u=i=>i>r,h=i=>o(i)&&s!==void 0,d=i=>{h(i)&&s?.(i)};if(n){const i=a.find(x=>x.number===r);return e.jsxs(g,{component:"nav",role:"navigation","aria-label":`Progress: Step ${r} of ${a.length}`,sx:{textAlign:"center",py:2},children:[e.jsxs(b,{variant:"body2",color:"text.secondary",children:["Step ",r," of ",a.length]}),e.jsx(b,{variant:"body1",sx:{fontWeight:500},children:i?.label})]})}return e.jsx(g,{component:"nav",role:"navigation","aria-label":`Progress: Step ${r} of ${a.length}`,sx:{py:{xs:1,sm:2},mb:{xs:2,sm:3},display:"flex",justifyContent:"center"},children:e.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:{xs:2,sm:4},margin:0,padding:0,listStyle:"none"},component:"ol",children:a.map(i=>{const x=o(i.number),p=c(i.number),f=u(i.number),m=h(i.number);return e.jsx(g,{component:"li",sx:{listStyle:"none",display:"flex",flexDirection:"column",alignItems:"center",width:{xs:80,sm:120},flexShrink:0},"aria-current":p?"step":void 0,children:e.jsxs(g,{component:m?"button":"div",onClick:m?()=>d(i.number):void 0,type:m?"button":void 0,"aria-label":m?`Go back to step ${i.number}: ${i.label}`:void 0,title:i.title,sx:{display:"flex",flexDirection:"column",alignItems:"center",cursor:m?"pointer":"default",background:"none",border:"none",padding:0,transition:"transform 0.2s","&:hover":m?{transform:"scale(1.05)"}:{}},children:[e.jsx(g,{sx:{width:{xs:36,sm:40},height:{xs:36,sm:40},borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:2,transition:"all 0.3s",...x&&{bgcolor:"primary.light",borderColor:"primary.light",color:"white"},...p&&{bgcolor:"primary.main",borderColor:"primary.main",color:"white",boxShadow:"0 0 0 4px rgba(249, 115, 22, 0.2)"},...f&&{bgcolor:"grey.200",borderColor:"grey.300",color:"grey.500"}},children:x?e.jsx(at,{sx:{fontSize:24},"aria-label":"Step completed"}):e.jsx(b,{variant:"body1",sx:{fontWeight:600},children:i.number})}),e.jsx(b,{variant:"caption",sx:{mt:{xs:.5,sm:1},textAlign:"center",fontWeight:500,height:{xs:28,sm:32},fontSize:{xs:"0.65rem",sm:"0.75rem"},display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1.2,...p&&{color:"primary.main"},...x&&{color:"primary.light"},...f&&{color:"text.disabled"}},children:i.label})]})},i.number)})})})};function Kt({error:r,onRetry:t,onDismiss:a,severity:s="error",showDetails:n=!1}){return r?e.jsxs(Ee,{severity:s,onClose:a,sx:{mb:2},role:"alert","aria-live":"assertive","aria-atomic":"true",children:[e.jsx(Fe,{children:"Error"}),r.userMessage,r.recoverySuggestion&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"0.875rem",opacity:.9},children:[e.jsx("strong",{children:"Suggestion:"})," ",r.recoverySuggestion]}),n&&r.message&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"0.75rem",fontFamily:"monospace",opacity:.7},children:["Technical details: ",r.message]}),r.canRetry&&t&&e.jsx(I,{direction:"row",spacing:1,sx:{mt:1},children:e.jsx(D,{size:"small",variant:"outlined",onClick:t,color:"inherit","aria-label":"Retry the failed operation",children:"Try Again"})})]}):null}const qt=["Image","Flag","Adjust"];function Ht(){const{mode:r,setMode:t}=l.useContext(Ae),a=Pe(),s=Se(a.breakpoints.down("sm")),n=Se(a.breakpoints.between("sm","md")),o=1024,c=s?Math.min(window.innerWidth-80,280):n?320:300,{currentStep:u,nextStep:h,prevStep:d,goToStep:i,startOver:x,completedSteps:p,imageUrl:f,setImageUrl:m,flagId:y,setFlagId:S}=Rt(),[w,M]=l.useState("ring"),[N,W]=l.useState(7),[A,R]=l.useState(0),[B,_]=l.useState(0),[F,re]=l.useState("transparent"),[X,v]=l.useState(!1),[P,k]=l.useState(!1),[E,O]=l.useState(null),[se,T]=l.useState(""),[Oe,ne]=l.useState(!1),De=l.useRef(null),Me=l.useRef(null),xe=yt(),{overlayUrl:K,isRendering:Be,render:be}=wt(ae,xe),{focusRef:Ue,setFocus:ye}=Ct();It(ae,xe,y);async function We(j){const L=j.target.files?.[0];if(!L)return;const q=URL.createObjectURL(L);m(q),T("Image selected successfully. Ready to select flag.")}function $e(j){S(j||"")}const oe=l.useCallback(async j=>{try{T("Rendering avatar..."),await be(j,y,{size:o,thickness:N,insetPct:A,flagOffsetX:B,presentation:w,bg:F}),O(null),T("Avatar rendered successfully. Ready to download.")}catch(L){const q=Z(L);O(q),H.error(`Render failed: ${q.message}`),T(`Error: ${q.message}`)}},[be,y,o,N,A,B,w,F]);l.useEffect(()=>{f&&y&&oe(f)},[f,y,oe]),l.useEffect(()=>()=>{f&&URL.revokeObjectURL(f)},[f]),l.useEffect(()=>{E&&setTimeout(()=>ye(),100)},[E,ye]);async function ve(){if(K)try{v(!0),await new Promise(L=>setTimeout(L,100));const j=document.createElement("a");j.href=K,j.download="avatar-with-border.png",j.click(),H.success("Avatar downloaded successfully!"),T("Avatar downloaded successfully.")}catch{H.error("Failed to download avatar"),T("Failed to download avatar.")}finally{v(!1)}}async function Ge(){if(K)try{if(k(!0),!navigator.clipboard||!window.ClipboardItem){const je="Copy to clipboard not supported in this browser";H.error(je),T(je),O(Z(new Error("Clipboard API not supported")));return}const L=await(await fetch(K)).blob(),q=new ClipboardItem({"image/png":L});await navigator.clipboard.write([q]),H.success("Avatar copied to clipboard!"),T("Avatar copied to clipboard!"),O(null)}catch(j){const L="Failed to copy to clipboard";H.error(L),T(L),O(Z(j))}finally{k(!1)}}St([{key:"d",ctrlKey:!0,callback:j=>{j.preventDefault(),ve()},description:"Download avatar",enabled:!!K}]);const ze=ae.find(j=>j.id===y)||null,_e=!!f,Ke=!!y;return e.jsxs(e.Fragment,{children:[e.jsx(st,{position:"bottom-right",toastOptions:{duration:4e3,style:{background:r==="dark"?"#333":"#fff",color:r==="dark"?"#fff":"#333"}}}),e.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"visually-hidden",children:se}),e.jsx("div",{role:"alert","aria-live":"assertive","aria-atomic":"true",className:"visually-hidden",children:E?`Error: ${E.message}`:""}),e.jsxs(g,{component:"main",id:"main-content","aria-labelledby":"app-title",sx:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",py:{xs:2,sm:3},px:{xs:2,sm:3}},children:[e.jsx(nt,{size:s?"large":"medium",onClick:()=>t(r==="light"?"dark":"light"),"aria-label":r==="light"?"Switch to dark mode":"Switch to light mode",sx:{position:"fixed",bottom:24,right:24,zIndex:1e3},children:r==="light"?e.jsx(ot,{}):e.jsx(it,{})}),e.jsxs(g,{sx:{maxWidth:600,width:"100%",mx:"auto"},children:[e.jsxs(g,{component:"header",role:"banner",sx:{mb:{xs:1.5,sm:3},textAlign:"center"},children:[e.jsx(b,{variant:"h4",component:"h1",id:"app-title",sx:{fontWeight:700,mb:1},children:"Beyond Borders"}),e.jsx(b,{variant:"subtitle1",color:"textSecondary",component:"p",children:"Add a circular, flag-colored border to your profile picture."})]}),e.jsx(_t,{currentStep:u,completedSteps:p,steps:qt.map((j,L)=>({number:L+1,label:j,title:j})),onStepClick:i}),E&&e.jsx(g,{ref:Ue,tabIndex:-1,sx:{mb:{xs:1.5,sm:2},outline:"none"},children:e.jsx(Kt,{error:E,onRetry:()=>{O(null),f&&y&&oe(f)},onDismiss:()=>O(null)})}),u===1&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:Me,accept:"image/jpeg,image/jpg,image/png",style:{display:"none"},id:"step1-file-upload",type:"file",onChange:We,"aria-label":"Choose image file (JPG or PNG, max 10 MB)"}),e.jsx(g,{component:"label",htmlFor:"step1-file-upload",sx:{width:{xs:"100%",sm:300},maxWidth:300,height:{xs:"100%",sm:300},aspectRatio:"1",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:{xs:2,sm:3},cursor:"pointer",transition:"all 0.2s",...f?{backgroundImage:`url(${f})`,backgroundSize:"cover",backgroundPosition:"center",boxShadow:3,"&:hover":{boxShadow:6,transform:"scale(1.02)"}}:{border:3,borderColor:"grey.300",borderStyle:"dashed",bgcolor:"grey.50","&:hover":{borderColor:"primary.main",bgcolor:"grey.100"}}},children:!f&&e.jsxs(g,{sx:{textAlign:"center",px:4},children:[e.jsx(Re,{sx:{fontSize:48,color:"grey.400",mb:1}}),e.jsx(b,{variant:"body1",color:"text.secondary",sx:{fontWeight:"medium"},children:"Choose your profile image"}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"or drag and drop it here"}),e.jsx(b,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:.5},children:"JPG or PNG"}),e.jsxs(g,{component:"button",type:"button",onClick:j=>{j.preventDefault(),j.stopPropagation(),ne(!0)},sx:{display:"inline-flex",alignItems:"center",gap:.5,background:"none",border:"none",padding:0,cursor:"pointer",color:"primary.main",textDecoration:"underline",textDecorationStyle:"dotted",fontSize:"0.75rem","&:hover":{color:"primary.dark"},"&:focus-visible":{outline:"2px solid",outlineColor:"primary.main",outlineOffset:2,borderRadius:.5}},"aria-label":"Learn about privacy: Your image stays on your device",children:[e.jsx(lt,{sx:{fontSize:14}}),"Stays on your device"]})]})}),e.jsx(g,{sx:{mb:3}}),e.jsx(g,{sx:{width:"100%",maxWidth:300,mx:"auto"},children:e.jsx(ue,{currentStep:u,canGoBack:!1,canGoNext:_e,onNext:h,nextLabel:"Select Flag"})})]}),u===2&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{spacing:3,sx:{mb:{xs:2,sm:3}},children:[e.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(g,{sx:{width:"100%",maxWidth:320},children:e.jsx(At,{flags:ae,selectedFlagId:y,onChange:$e,disabled:!1})})}),e.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(Dt,{flag:ze,size:"large",animate:!0})})]}),e.jsx(g,{sx:{width:"100%",maxWidth:300,mx:"auto"},children:e.jsx(ue,{currentStep:u,canGoBack:!0,canGoNext:Ke,onBack:d,onNext:h,onStartOver:x,backLabel:"Back",nextLabel:"Adjust"})})]}),u===3&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{spacing:3,sx:{mb:{xs:2,sm:3}},children:[e.jsx(g,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx($t,{size:o,displaySize:c,canvasRef:De,overlayUrl:K,isRendering:Be,hasImage:!!f,hasFlag:!!y})}),e.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(g,{sx:{width:"100%",maxWidth:400},children:e.jsx(Le,{value:w,onChange:M})})}),e.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(g,{sx:{maxWidth:400,width:"100%"},children:e.jsxs(I,{spacing:3,children:[e.jsx(J,{label:"Border thickness",value:N,min:3,max:20,step:1,onChange:W,unit:"%"}),e.jsx(J,{label:"Profile Image Inset/Outset",value:A,min:-10,max:10,step:1,onChange:R,unit:"%"}),w==="cutout"&&e.jsx(J,{label:"Flag Horizontal Offset",value:B,min:-200,max:200,step:5,onChange:_,unit:"px"}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(ge,{id:"background-select-label",children:"Background"}),e.jsxs(fe,{value:F,onChange:j=>re(j.target.value),label:"Background",labelId:"background-select-label",children:[e.jsx(z,{value:"transparent",children:"Transparent"}),e.jsx(z,{value:"#ffffff",children:"White"}),e.jsx(z,{value:"#000000",children:"Black"})]})]})]})})})]}),e.jsx(g,{sx:{mb:3}}),e.jsx(g,{sx:{width:"100%",maxWidth:300,mx:"auto"},children:e.jsx(ue,{currentStep:u,canGoBack:!0,canGoNext:!1,onBack:d,onFinish:ve,onStartOver:x,isLoading:X,backLabel:"Back",finishLabel:"Download"})}),e.jsx(g,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(D,{variant:"text",onClick:Ge,disabled:!K||P,sx:{color:"text.secondary",minHeight:44},children:P?"Copying...":"Copy to Clipboard"})})]})]}),e.jsxs(ct,{open:Oe,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,"aria-labelledby":"privacy-dialog-title","aria-describedby":"privacy-dialog-description",children:[e.jsx(dt,{id:"privacy-dialog-title",children:"Your Privacy is Protected"}),e.jsx(ut,{children:e.jsxs(I,{spacing:2,sx:{pt:1},children:[e.jsxs(b,{variant:"body1",id:"privacy-dialog-description",children:["Beyond Borders processes everything ",e.jsx("strong",{children:"directly in your browser"}),". Your images never leave your device."]}),e.jsx(b,{variant:"body2",children:e.jsx("strong",{children:"What this means:"})}),e.jsxs(g,{component:"ul",sx:{pl:2,my:1},children:[e.jsx(b,{component:"li",variant:"body2",sx:{mb:1},children:"✓ No uploads to servers"}),e.jsx(b,{component:"li",variant:"body2",sx:{mb:1},children:"✓ No cloud storage"}),e.jsx(b,{component:"li",variant:"body2",sx:{mb:1},children:"✓ No tracking or analytics"}),e.jsx(b,{component:"li",variant:"body2",children:"✓ Complete privacy and control"})]}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"All image processing happens using HTML5 Canvas technology in your browser. When you download your avatar, it's created and saved directly on your device. We never see, store, or have access to your images."}),e.jsxs(b,{variant:"body2",color:"text.secondary",children:["This is an open source project so if you want to look through the code, it's"," ",e.jsx(g,{component:"a",href:"https://github.com/ravendarque/ravendarque-beyond-borders",target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"underline","&:hover":{color:"primary.dark"},"&:focus-visible":{outline:"2px solid",outlineColor:"primary.main",outlineOffset:2,borderRadius:.5}},children:"here on GitHub"}),"."]})]})}),e.jsx(pt,{children:e.jsx(D,{onClick:()=>ne(!1),variant:"contained",autoFocus:!0,children:"Got it"})})]})]})]})}function Ne(r){const t="#f8fafc",a="#121212",s="#f97316",n={palette:{mode:r,primary:{main:s},background:{default:r==="light"?t:a,paper:r==="light"?"#ffffff":ce[900]},text:{primary:r==="light"?"#0f172a":ce[100],secondary:r==="light"?"#6b7280":ce[400]}},shape:{borderRadius:12},typography:{fontFamily:'Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial'},components:{MuiCssBaseline:{styleOverrides:{"*, *::before, *::after":{boxSizing:"border-box"},html:{height:"100%"},"html, body, #root":{height:"100%"},body:{backgroundColor:r==="light"?t:a,margin:0,color:r==="light"?"#0f172a":"#e6eef3",fontFamily:'Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial'},"select:focus, input[type=range]:focus, input[type=color]:focus, input[type=file]:focus, button:focus":{outline:"none",boxShadow:"0 0 0 4px rgba(249,115,22,0.12)",borderColor:s},".visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",whiteSpace:"nowrap",border:0}}}}};return gt(n)}Ne("light");class Jt extends l.Component{constructor(t){super(t),this.state={error:null,hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:Z(t)}}componentDidCatch(t,a){console.error("ErrorBoundary caught an error:",t,a),this.props.onError&&this.state.error&&this.props.onError(this.state.error)}handleReset=()=>{this.setState({error:null,hasError:!1})};render(){return this.state.hasError&&this.state.error?this.props.fallback?this.props.fallback(this.state.error,this.handleReset):e.jsx(ft,{maxWidth:"md",sx:{mt:4},children:e.jsxs(he,{sx:{p:4},children:[e.jsxs(Ee,{severity:"error",sx:{mb:3},children:[e.jsx(Fe,{children:"Something Went Wrong"}),this.state.error.userMessage]}),e.jsxs(I,{spacing:2,children:[e.jsx(b,{variant:"body1",children:this.state.error.recoverySuggestion||"Please try refreshing the page. If the problem persists, contact support."}),e.jsxs(I,{direction:"row",spacing:2,children:[e.jsx(D,{variant:"contained",onClick:this.handleReset,children:"Try Again"}),e.jsx(D,{variant:"outlined",onClick:()=>window.location.reload(),children:"Refresh Page"})]}),e.jsxs("details",{style:{marginTop:"16px"},children:[e.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:"Technical Details (for debugging)"}),e.jsx("pre",{style:{marginTop:"8px",padding:"12px",backgroundColor:"#f5f5f5",borderRadius:"4px",fontSize:"0.75rem",overflow:"auto"},children:JSON.stringify(this.state.error.toJSON(),null,2)})]})]})]})}):this.props.children}}const Ae=l.createContext({mode:"dark",setMode:()=>{}}),Xt=document.getElementById("root");function Vt(){const r=()=>{try{const o=localStorage.getItem("bb:mode");return o==="light"||o==="dark"?o:"dark"}catch{return"dark"}},[t,a]=l.useState(r),s=l.useMemo(()=>Ne(t),[t]),n=o=>{try{localStorage.setItem("bb:mode",o)}catch{}a(o)};return C.useEffect(()=>{try{document.documentElement.setAttribute("data-theme",t)}catch{}},[t]),e.jsx(Ae.Provider,{value:{mode:t,setMode:n},children:e.jsxs(mt,{theme:s,children:[e.jsx(xt,{}),e.jsx(Jt,{children:e.jsx(Ht,{})})]})})}ht.createRoot(Xt).render(e.jsx(C.StrictMode,{children:e.jsx(Vt,{})}));
